<div class="container">
  <h2>Administración de Usuarios</h2>

  <mat-progress-bar *ngIf="isLoading" mode="indeterminate"></mat-progress-bar>

  <div *ngIf="!isLoading">
    <!-- Pestañas para usuarios activos/inactivos -->
    <mat-tab-group>
      <mat-tab label="Usuarios Activos">
        <div class="cards-container">
          <mat-card *ngFor="let user of activeUsers" class="active-card" (click)="toggleExpand(user.id)">
            <mat-card-header>
              <mat-card-title>{{ user.name }}</mat-card-title>
              <mat-card-subtitle>
                <mat-icon [color]="getRoleColor(user.role)">person</mat-icon>
                {{ user.role }}
              </mat-card-subtitle>
            </mat-card-header>

            <mat-card-content>
              <div *ngIf="expandedUserId === user.id" class="user-details">
                <p><strong>Email:</strong> {{ user.email }}</p>
                <p><strong>Registrado:</strong> {{ user.created_at | date }}</p>
              </div>
              <div *ngIf="expandedUserId !== user.id" class="user-summary">
                <p>{{ user.email }}</p>
                <mat-icon [color]="getStatusColor(user.is_active)">
                  {{ getStatusIcon(user.is_active) }}
                </mat-icon>
              </div>
            </mat-card-content>

            <mat-card-actions align="end">
              <button mat-icon-button color="primary" (click)="changeUserRole(user.id, 'admin'); $event.stopPropagation()"
                      matTooltip="Hacer administrador">
                <mat-icon>admin_panel_settings</mat-icon>
              </button>
              <button mat-icon-button color="accent" (click)="changeUserRole(user.id, 'user'); $event.stopPropagation()"
                      matTooltip="Hacer usuario normal">
                <mat-icon>person</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="resetUserPassword(user.id); $event.stopPropagation()"
                      matTooltip="Restablecer contraseña">
                <mat-icon>vpn_key</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="toggleUserStatus(user.id); $event.stopPropagation()"
                      matTooltip="Desactivar usuario">
                <mat-icon>block</mat-icon>
              </button>
            </mat-card-actions>
          </mat-card>
        </div>
      </mat-tab>

      <mat-tab label="Usuarios Inactivos">
        <div class="cards-container">
          <mat-card *ngFor="let user of inactiveUsers" class="inactive-card" (click)="toggleExpand(user.id)">
            <mat-card-header>
              <mat-card-title>{{ user.name }}</mat-card-title>
              <mat-card-subtitle>
                <mat-icon [color]="getRoleColor(user.role)">person</mat-icon>
                {{ user.role }}
              </mat-card-subtitle>
            </mat-card-header>

            <mat-card-content>
              <div *ngIf="expandedUserId === user.id" class="user-details">
                <p><strong>Email:</strong> {{ user.email }}</p>
                <p><strong>Registrado:</strong> {{ user.created_at | date }}</p>
              </div>
              <div *ngIf="expandedUserId !== user.id" class="user-summary">
                <p>{{ user.email }}</p>
                <mat-icon [color]="getStatusColor(user.is_active)">
                  {{ getStatusIcon(user.is_active) }}
                </mat-icon>
              </div>
            </mat-card-content>

            <mat-card-actions align="end">
              <button mat-icon-button color="primary" (click)="toggleUserStatus(user.id); $event.stopPropagation()"
                      matTooltip="Activar usuario">
                <mat-icon>check_circle</mat-icon>
              </button>
            </mat-card-actions>
          </mat-card>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>